title: Last.FM scrobbling with ncspot and rescrobbled
root: ../
footer:
    source: blog/lastfm-scrobbling-with-ncspot-and-rescrobbled.yml
datetime: 2022-03-16
content:
    - header: hello
    - paragraph: >
        Rescrobbled is a daemon written in Rust which works by using the <a href="https://wiki.archlinux.org/title/MPRIS">MPRIS</a> D-Bus interface to detect your songs, scrobbling them to a Last.fm (or ListenBrainz) compatible service.
    - paragraph: >
        This can be used with Spotify's official client, a web browser, or even something like ncspot.
    - header: ncspot
    - paragraph: >
        <a href="https://github.com/hrkfdn/ncspot">ncspot</a> is a lightweight ncurses Spotify terminal client written in Rust using <code>librespot</code>. It is less intuitive than Spotify's native electron app but consumes much less memory.
    - paragraph: >
        Installing it on Debian is very straightforward. Extract the binary from https://github.com/hrkfdn/ncspot/releases to <code>/usr/local/bin/ncspot</code>, then open a terminal and run <code>ncspot</code>. The first run will prompt for credentials to a Spotify premium account.
    - subheader: configuration
    - paragraph: >
        You will probably want volume normalization.
        <code>~/.config/ncspot/config.toml</code>
    - code: >
        volnorm = true
    - paragraph: >
        The rest of the configuration is documented at <a href="https://github.com/hrkfdn/ncspot#configuration">https://github.com/hrkfdn/ncspot#configuration</a>.
    - header: rescrobbled
    - paragraph: >
        The rescrobbled binaries on GitHub were compiled with a version of <code>glib</code> than my Debian system did not have, so I have to compile from source.
        Compiling is straightforward if you already have <code>cargo</code> installed.
        Get the dev dependencies.
        <code>sudo apt install libdbus-1-dev pkg-config libssl-dev</code>
        And compile and install with <code>cargo</code>.
        <code>cargo install rescrobbled</code>
    - paragraph: >
        To use rescrobbled with Last.Fm, get an API account at <a href="https://www.last.fm/api/account/create">https://www.last.fm/api/account/create</a>. Only the <code>Application name</code> field is required, the rest of the fields can be left blank.
        Then, play the lastfm-key and lastfm-secret.
        <code>~/.config/rescrobbled/config.toml</code>
    - code: >
        lastfm-key = "xxx"
        lastfm-secret = "xxx"
    - paragraph: >
        After this, consider creating a <code>systemd</code> unit file so rescrobbled can run as a daemon in the background when the computer starts.  
        <code>~/.config/systemd/user/rescrobbled.service</code>
    - code: >
        [Unit]
        Description=An MPRIS scrobbler
        Documentation=https://github.com/InputUsername/rescrobbled
        Wants=network-online.target
        After=network-online.target

        [Service]
        ExecStart=%h/.cargo/bin/rescrobbled

        [Install]
        WantedBy=default.target
    - paragraph: >
        Enable this new unit file with <code>systemctl --user enable rescrobbled.service</code>
        Then, restart the computer or try <code>systemctl --user start rescrobbled.service</code>
    - paragraph: >
        Also consider configuring rescrobbled to avoid scrobbling everything that plays on the computer by only whitelisting music players.
        <code>~/.config/rescrobbled/config.toml</code>
    - code: >
        player-whitelist = [ "ncspot" ]
