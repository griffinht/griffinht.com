<!DOCTYPE html>
<html>
  <head>
    <title>Cards</title>
    <style>
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script>
var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
var lastFrame = new Date();
var variables = {};
function Variable(args){
  if(typeof args !== 'object'){args = {};}
  if(typeof args.id !== 'string'){this.id = Math.random();}else{this.id = args.id;}
  if(typeof args.value === 'undefined'){this.value = 'null';}else{this.value = args.value;}
  variables[this.id] = this;
}
var menus = {};
function Menu(args){
  if(typeof args !== 'object'){args = {};}
  if(typeof args.id !== 'string'){this.id = Math.random();}else{this.id = args.id;}
  if(typeof args.x === 'number'){//types: 0 = x position, 1 = x position from opposite, 2 = x percent from middle (.5 (50%) = centered)
    this.x = args.x;
    if(!typeof args.xType === 'number' && args.xType >= 0 && args.xType <= 2){this.xType = 0;}else{this.xType = args.xType;}
  }else{
    this.x = 0;
  }
  if(typeof args.y === 'number'){//types: 0 = y position, 1 = y position from opposite, 2 = y percent from middle (.5 (50%) = centered)
    this.y = args.y;
    if(!typeof args.yType === 'number' && args.yType >= 0 && args.yType <= 2){this.yType = 0;}else{this.yType = args.yType;}
  }else{
    this.y = 0;
  }
  if(!typeof args.width === 'string' && args.width === 'relative'){
    this.width = args.width;
    if(typeof this.width !== 'number'){this.width = variables['defaultWidth'];}
  }else{this.width = args.width;}
  if(!typeof args.height === 'string' && args.height === 'relative'){
    this.height = args.height;
    if(typeof this.height !== 'number'){this.height = variables['defaultWidth'];}
  }else{this.height = args.height;}
  if(typeof args.value !== 'string'){this.value = '<padding> <fontSize> Blank'}else{this.value = args.value;}
  this.format = function(){
    for(var i = 0; i < this.value.length; i++){
      if(this.value.substring(i,i+1) === '<'){
        for(var x = i; x < this.value.length; x++){
          if(this.value.substring(x,x+1) === '>'){
            this.value = this.value.substring(0,i)+variables[this.value.substring(i+1,x)].value+this.value.substring(x+1,this.value.length);
            break;
          }
        }
      }
    }
  }
  menus[this.id] = this;
}
var socket = io();
socket.on('info',function(data){
  for(var id in data){
    new Variable({id:id, value:data[id]});
  }
  new Variable({id:'fps', value:60});
  ctx.font = variables['fontSize'].value+variables['fontUnit']+' '+variables['fontFamily'].value;
  console.log(variables['fontSize'].value+' '+variables['fontUnit']+' '+variables['fontFamily'].value);
  setInterval(function(){//main
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(var id in menus){
      var now = new Date();
      variables['fps'].value = 1000/(now.getTime()-lastFrame.getTime());
      menus[id].format();
      ctx.fillStyle = variables['backgroundColor'].value;
      ctx.fillRect(menus[id].x, menus[id].y, menus[id].width, menus[id].height);
      var size = ctx.measureText(menus[id].value);
      ctx.fillStyle = variables['fontColor'].value;
      ctx.fillText(menus[id].value, menus[id].x+variables['padding'].value, menus[id].y+variables['padding'].value);
      lastFrame = now;
    }
  },1000/variables['targetFPS'].value);
  socket.on('aping',function(data){//latency
    socket.emit('apong');
    socket.on('latency',function(data){latency = data;});
  });
  new Menu({id:'fps', x:5, y:50, xType:1, yType:1, width:50, height:150, value:'FPS: <fps>'});
});
    </script>
  </body>
</html>